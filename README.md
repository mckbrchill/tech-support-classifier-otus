# Финальный проект по курсу Otus MLOps

## Тема: Классификация пользовательских обращений в техническую поддержку

Данные представляют собой неразмеченные пользовательские обращения в техническую поддержку.

Objective - разработать систему разметки + классификации заявок, приходящих в техническую поддержку.

## HLD
Основной пайплайн:

![name](./static/hld.JPG)

(п.1-3 оркестрируются в Airflow)

1. Препроцессинг данных с S3
2. Разметка данных
    * (автоматически) Разметка по предобученным моделям
    * (опционально) (полуавтоматически) Переобучение моделей разметки
3. Обучение классификатора, сохранение метрик и статтестов MLFlow
4. Обученная модель обернута в Fast API + Docker
5. По push в репо с изменением модели - github actions на пересборку контейнера
6. Собранный контейнер деплоится в k8s, где есть автомасштабирование
7. Продовые метрики отображаем в графане, стреляем алертами в тг

## ML


## Структура репо
- **data/**: исходные данные
- **notebooks/**: EDA + pipeline, который лежит в основе проекта
- **sсrips/**: основные одиночные скрипты
  - **spark_pipeline/**: скрипты для препроцессинга, разметки, переразметки и обучения модели на spark
  - **py_pipeline/**: скрипты для препроцессинга, разметки, переразметки и обучения модели на python
  - **airflow_dags/**: даги для Airflow
- **src/**: исходный код сервиса Fast API
- **Dockerfile**: докерфайл для сервиса
- **k8s/**: манифесты для настройки работы сервиса в k8s
- **pyprojects.toml**: зависимости



# Артефакты проекта
## ВМ для оркестрации через Airflow и версионирования экспериментов через MLFlow
![vms](/static/vms.JPG)

## Удачный ран по препроцессингу, леблингу и обучению в Airflow
![airflow-training](/static/airflow.JPG)

## Метрики в MLFLow
![mlflow1](/static/mflow1.JPG)

![mlflow2](/static/mlflow2.JPG)

## K8s deployments
![k8s1](/static/k8s_deployments.JPG)

## K8s pods
![k8s1](/static/k8s_pods.JPG)

## Чекаем работоспособность сервиса в кубере
![k8s3](/static/test_service_in_k8s.JPG)

## Прометеус + графана для мониторинга
![prom](/static/prometheus.JPG)

![graf](/static/grafana_dashboard.JPG)

![graf](/static/grafana_alert.JPG)

## Алерт в тг боте при превышении рейта по классификации топика Theft/Dispute reporting 
![graf](/static/tg-alert.JPG)



